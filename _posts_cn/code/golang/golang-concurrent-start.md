---
title: Golang 高并发初步
tags:
  - Golang
  - 编程语言
  - 编程
date: 2019-05-14
---

通常程序会被编写为一个顺序执行并完成一个独立任务的代码。**如果没有特别的需求，最好总是这样写代码。**

但是有些情况并行执行多个任务会有更大的好处。比如说： Web 服务需要在各自独立的套接字(socket)上同时接受多个请求数据。每个套接字请求都是独立的，可以完全**独立**于其他套接字进行处理。具有并行执行多个请求的能力可以显著提高这类系统的性能。

Golang 中并发指**能让某个函数独立于其他函数运行的能力**。

当一个函数创建 `goroutine` 时，Golang 会将其视为一个独立的工作单元。这个单元会被调度到可用的逻辑处理器上执行。

运行时调度器**能管理被创建的所有 `goroutine` 并为其分配执行时间**。在任何给定的时间，全面控制哪个 `goroutine` 在哪个逻辑处理器上运行。

Golang 语言的并发同步模型来自一个叫做**通信顺序进程**(Communicating Sequential Processes, CSP)的范型。

CSP 是一种消息传递模型，通过在 `goroutine` 之间传递数据来传递消息，而不是对数据进行加锁来实现同步访问。用于在 `goroutine` 之间同步和传递数据的关键数据类型叫**通道**。

## 并行和并发

### 什么是**进程**和**线程**

当运行一个应用程序的时候，操作系统会为这个应用程序启动一个进程。可以将这个进程看做一个包含了应用程序在运行中需要用到和维护的各种资源的容器。

![](https://sherlockblaze.com/resources/img/code/golang/processing-and-running-program.png)

上图展示了一个包含所有可能分配的常用资源的进程。这些资源**包括但不限于**: 内存地址空间、文件和设备的句柄以及线程。

一个线程是一个执行空间，这个空间会被操作系统调度来运行函数中所写的代码。 

每个进程至少包含一个线程，每个进程的初始化线程会被称作**主线程**。

操作系统将线程调度到某个处理器上运行，这个处理器不一定是进程所在的处理器。

操作系统会在物理处理器上调度线程来运行，而 Go 语言的运行时会在逻辑处理器上调度 `goroutine` 来运行。**每个逻辑处理器都分别绑定到单个操作系统线程。**